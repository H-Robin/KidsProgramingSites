<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Programming Games Launcher</title>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=M+PLUS+Rounded+1c:wght@700&family=Poppins:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background:#0f172a; color:#e2e8f0; }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); padding: 16px; }
    .card { background:#000000; border:1px solid #334155; border-radius:16px; padding:16px; }
  </style>
</head>
<body>
  <header>HamaKidsQuest</header>
    <section class="grid">
      <article class="card">
        <div class="card-hero">
          <div class="card-text">
            <h3>Space Program Kids(スペースプログラムキッズ）</h3>
            <p>命令コマンドを並べてロボットを動かし、ゴールへ向かわせてください。</p>
            <p>順次処理 → 繰り返し処理を学ぶミッションクリア型のプログラミング学習ゲームです。</p>
            <p>ミッションは、今後どんどん追加していきます。</p>
            <a class="btn" href="./games/hama-kids-quest/html/hkq-map.html">プレイ</a>
          </div>
          <div class="card-image">
            <img src="./games/hama-kids-quest/assets/cutscene/game-title.png" alt="ゲームイメージ">
          </div>
        </div>
      </article>
    </section>
    <!-- ▼ Safari用ブロックオーバーレイ（修正版） -->
    <div id="safari-block" style="display:none; position:fixed; inset:0;
        background:#0b1020; color:#fff; z-index:99999; 
        align-items:center; justify-content:center;">
      <div style="max-width:680px; padding:24px; background:#111a33; border-radius:16px; text-align:center;">
        <h2>Safari は現在サポートしていません</h2>
        <p>Google Chrome または Microsoft Edge でご利用ください。</p>
        <p>
          <a href="https://www.google.com/chrome/" style="color:#9bd1ff;">Chrome を入手</a> ／
          <a href="https://www.microsoft.com/edge" style="color:#9bd1ff;">Edge を入手</a>
        </p>
      </div>
    </div>
    <script>
      // ====================================================================
      //  Safari制限のワンタッチ切替（ローカル専用スイッチ）
      //  - localStorage.hkqBlockSafari === '1' のとき、Safari をブロック
      //  - ?admin=1 で管理用のフローティング切替ボタンを表示
      //  - ?allowSafari=1 が付いている場合は、管理フラグよりも優先して許可
      // ====================================================================
      (function () {
        var ua = navigator.userAgent;
        // デスクトップSafari（iOS版Chrome/Firefox/Edgeを除外）
        var isSafari = /Safari/.test(ua) && !/(Chrome|Chromium|Edg|OPR|Brave|CriOS|FxiOS|EdgiOS)/.test(ua);
        // iOS純正Safari
        var isIOSSafari = /iP(hone|ad|od)/.test(ua) && /Safari/.test(ua) && !/(CriOS|FxiOS|EdgiOS)/.test(ua);

        var params = new URLSearchParams(location.search);
        var adminUI = params.get('admin') === '1';
        var allowSafariByQuery = params.has('allowSafari'); // 一時的な許可

        // 管理フラグ（'1'でSafariブロックON）
        var blockFlag = (localStorage.getItem('hkqBlockSafari') === '0');

        function applyBlocking() {
          // ?allowSafari=1 が付いている場合は常に許可
          var shouldBlock = !allowSafariByQuery && blockFlag && (isSafari || isIOSSafari);
          var overlay = document.getElementById('safari-block');
          if (!overlay) return;
          overlay.style.display = shouldBlock ? 'flex' : 'none';
        }

        function installAdminToggle() {
          if (!adminUI) return;
          var btn = document.createElement('button');
          btn.id = 'hkq-safari-toggle';
          btn.type = 'button';
          btn.textContent = 'Safari制限: ' + (blockFlag ? 'ON' : 'OFF');
          Object.assign(btn.style, {
            position: 'fixed', right: '12px', top: '12px', zIndex: 100000,
            padding: '8px 12px', borderRadius: '10px', border: '1px solid #334155',
            background: '#0b132b', color: '#9bd1ff', font: '12px/1 system-ui, sans-serif',
            boxShadow: '0 2px 10px rgba(0,0,0,.3)', cursor: 'pointer'
          });
          btn.addEventListener('click', function(){
            blockFlag = !blockFlag;
            localStorage.setItem('hkqBlockSafari', blockFlag ? '1' : '0');
            btn.textContent = 'Safari制限: ' + (blockFlag ? 'ON' : 'OFF');
            applyBlocking();
          });
          document.body.appendChild(btn);
        }

        // 初期適用 & 管理UI
        applyBlocking();
        installAdminToggle();

        // デバッグ表示（任意）
        if (params.get('debug') === 'ua') {
          var panel = document.createElement('div');
          panel.style.position = 'fixed';
          panel.style.bottom = '0';
          panel.style.right = '0';
          panel.style.background = 'rgba(0,0,0,.7)';
          panel.style.color = '#0ff';
          panel.style.font = '12px/1.4 monospace';
          panel.style.padding = '6px 10px';
          panel.style.zIndex = '100000';
          panel.textContent = 'UA=' + ua + '\n' + 'isSafari=' + isSafari + ' / isIOSSafari=' + isIOSSafari + ' / blockFlag=' + blockFlag + ' / allowSafari=' + allowSafariByQuery;
          document.body.appendChild(panel);
        }
      })();
    </script>
</body>
</html>